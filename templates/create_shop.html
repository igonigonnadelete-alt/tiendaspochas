<!DOCTYPE html>
<html>
<head>
  <title>crear - tiendaspochas</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
  <link href="https://fonts.googleapis.com/css2?family=Funnel+Display:wght@300..800&family=Oswald:wght@200..700&display=swap" rel="stylesheet">
</head>
<body>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-container">
        {% for category, message in messages %}
          <div class="flash flash-{{ category }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Top bar -->
  <div class="topbar">
    <div class="topbar-left">
      <a href="https://www.youtube.com/watch?v=5VX4ZXFZ8_8">
        <img src="{{ url_for('static', filename='logo.png') }}" style="width:40px;">
      </a>
    </div>

    <div class="topbar-center">
      <a href="/"><h1>tiendaspochas</h1></a>
    </div>

    <div class="topbar-right">
      <div class="user-menu">
        {% if session.get("user_id") %}
          <button class="user-btn">
            {{ session["username"] }} ▾
          </button>
          <div class="dropdown">
            <a href="/logout">cerrar sesión</a>
          </div>
        {% else %}
          <button class="user-btn">
            entrar ▾
          </button>
          <div class="dropdown">
            <a href="/login">iniciar sesión</a>
            <a href="/register">registrarse</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Page layout -->
  <div class="layout">

    <!-- Sidebar -->
    <div class="sidebar">
      <div><a href="/"><img src="{{ url_for('static', filename='homebtn.png') }}" style="width: 30px;"> <span>tiendas</span></a></div>
      <div class="current"><a href="/create"><img src="{{ url_for('static', filename='addbtn.png') }}" style="width: 30px;"> <span>crear</span></a></div>
      <div class="spacing"></div>
      {% if session.get("user_id") and session.get("is_admin") %}<div><a href="/admin"><img src="{{ url_for('static', filename='adminbtn.png') }}" style="width: 30px;"> <span>admin</span></a></div>{% else %}<div><a onclick="playClick()"><img src="{{ url_for('static', filename='ahhbtn.png') }}" style="width: 30px;"> <span>ahh</span></a></div>{% endif %}
    </div>

    <!-- Main content -->
    <div class="content">

    <h1 class="center">crear tienda</h1>

    <form method="POST" enctype="multipart/form-data">
      <small id="titleCount">0 / 70</small>
      <input id="title" name="title" type="text" placeholder="titulo de la tienda" maxlength="70" required>
      <input id="username" name="username" type="hidden" value="{{ session['username'] }}" required>
      <input id="x" name="x" type="number" placeholder="X" min="-9999999" max="9999999" required>
      <input id="y" name="y" type="number" placeholder="Y" min="-9999999" max="9999999" required>
      <input id="image" name="image" type="file" accept="image/*" required>
      <div id="shopPreview" class="shop" style="display:none;">
        <img id="previewImage">
        <div class="shop-txt">
          <h2 id="previewTitle">titulo de la tienda</h2>
          <h4 id="previewUser">{{ session['username'] }}</h4>
        </div>
        <h3 class="coords">
          X: <span id="previewX">0</span>
          Y: <span id="previewY">0</span>
        </h3>
      </div>
      <button>Create</button>
    </form>
    <h1 class="fill">:3</h1>
    </div>
  </div>
  <audio id="ahh-sound" src="{{ url_for('static', filename='sounds/ahh.mp3') }}"></audio>
  <script>
    const titleInput = document.getElementById("title");
    const userInput = document.getElementById("username");
    const xInput = document.getElementById("x");
    const yInput = document.getElementById("y");
    const imageInput = document.getElementById("image");

    const previewBox = document.getElementById("shopPreview");
    const previewTitle = document.getElementById("previewTitle");
    const previewUser = document.getElementById("previewUser");
    const previewX = document.getElementById("previewX");
    const previewY = document.getElementById("previewY");
    const previewImage = document.getElementById("previewImage");

    const title = document.getElementById("title");
    const count = document.getElementById("titleCount");

    const clickSound = document.getElementById("ahh-sound");

    function showPreview() {
      previewBox.style.display = "grid";
    }

    titleInput.addEventListener("input", () => {
      previewTitle.textContent = titleInput.value || "titulo de la tienda";
      showPreview();
    });

    userInput.addEventListener("input", () => {
      previewUser.textContent = userInput.value || "{{ session['username'] }}";
      showPreview();
    });

    xInput.addEventListener("input", () => {
      previewX.textContent = xInput.value || "0";
      showPreview();
    });

    yInput.addEventListener("input", () => {
      previewY.textContent = yInput.value || "0";
      showPreview();
    });

    imageInput.addEventListener("change", () => {
      const file = imageInput.files[0];
      if (!file || !file.type.startsWith("image/")) return;

      previewImage.src = URL.createObjectURL(file);
      showPreview();
    });

    title.addEventListener("input", () => {
      count.textContent = `${title.value.length} / ${title.maxLength}`;
    });

    function playClick() {
      clickSound.currentTime = 0; // rewind
      clickSound.play();
    }
  </script>
<script>
  setTimeout(() => {
  document.querySelectorAll(".flash").forEach(el => {
    el.classList.add("hide");
    setTimeout(() => el.remove(), 500);
  });
}, 4000);
</script>
</body>
</html>